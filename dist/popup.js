(()=>{"use strict";var e={874:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function s(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,c)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.App=void 0;const o=i(623),r=i(177),s=i(170),c=i(561);function a(e){const t=document.getElementById("spotify-login-notification"),i=document.getElementById("please-open-spotify-box"),n=document.getElementById("spotify-player");switch(e){case"spotify-player-box":n.style.display="flex",t.style.display="none",i.style.display="none";break;case"please-login-box":n.style.display="none",t.style.display="flex",i.style.display="none";break;case"please-open-spotify-box":t.style.display="none",n.style.display="none",i.style.display="flex"}}t.App=class{constructor(){this.token=null,this.track=null}render(){return n(this,void 0,void 0,(function*(){this.token=yield c.getAccessToken(),this.isLoggedIn()?(this.device=yield s.getDeviceID(this.token.accessToken),void 0!==this.device?(yield this.showPlayerUI(),s.registerEvents(this.token,this.device.id,this.track,this.render.bind(this))):a("please-open-spotify-box")):a("please-login-box")}))}showPlayerUI(){return n(this,void 0,void 0,(function*(){a("spotify-player-box");const e=r.Cache.retrieve(o.STORAGE_KEY);this.track=yield this.getTrack(e),c.isUpdateStorage(e,this.track)?r.Cache.storeWithKey(o.STORAGE_KEY,this.track):this.track?this.track=e:this.track=Object.assign(Object.assign({},e),{isPlaying:!1}),this.displayTrackInfo(),this.startTimer(),s.displayControlItems("play")}))}isLoggedIn(){return!this.token.isAnonymous}getTrack(e){return n(this,void 0,void 0,(function*(){let t,i=yield c.getRecentPlayback(this.token.accessToken);switch(i?i.item||(t="no-song-playing"):t=e?"cache":"nothing",t){case"nothing":case"no-song-playing":i=yield c.getRecentlyPlayedTrack(this.token.accessToken);break;case"cache":i=e}return i=c.parse(i),i}))}displayTrackInfo(){return n(this,void 0,void 0,(function*(){const e=this.track,t=document.getElementById("title"),i=document.getElementById("artist"),n=document.getElementById("cover-photo-wrapper"),{title:o,artist:r,coverPhoto:s,trackUrl:c}=e;if(o&&(t.textContent=o,t.setAttribute("title",o),t.setAttribute("href",c),t.setAttribute("target","_blank"),t.style.textDecoration="none",t.style.fontWeight="bold"),r&&(i.textContent=r.name,i.setAttribute("title",r.name),i.setAttribute("href",r.url),i.setAttribute("target","_blank"),i.style.textDecoration="none",i.style.fontStyle="italic"),s){const e=document.createElement("img");e.setAttribute("src",s),e.setAttribute("id","cover-photo"),e.setAttribute("class","mini-spotify-right-panel mini-spotify-cover-photo"),e.setAttribute("title",`${o} - ${r.name}`),e.setAttribute("alt",`${o} - ${r.name}`),document.getElementById("cover-photo")&&n.removeChild(document.getElementById("cover-photo")),n.append(e)}}))}startTimer(){if(!this.track)return;const e=this.track.durationMs,t=this.track.progressMs||0,i=setTimeout((()=>n(this,void 0,void 0,(function*(){yield this.showPlayerUI(),clearTimeout(i)}))),e-t)}togglePlay(){this.track.isPlaying?s.displayControlItems("pause"):s.displayControlItems("play")}}},177:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Cache=void 0,t.Cache=class{static retrieve(e){let t;try{t=JSON.parse(localStorage.getItem(e))}catch(e){t=void 0}return t}static storeWithKey(e,t){localStorage.setItem(e,JSON.stringify(t))}}},623:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TIME_OUT=t.HOUR_IN_SECOND=t.STORAGE_KEY=t.CONTEXT_MENU_ITEM_TEXT=t.CONTEXT_MENU_ITEM=t.API_URL=t.WEB_PLAYER_URL=void 0,t.WEB_PLAYER_URL="https://open.spotify.com",t.API_URL="https://api.spotify.com",t.CONTEXT_MENU_ITEM="spotify-extension-search-on-spotify",t.CONTEXT_MENU_ITEM_TEXT='Search Spotify for "%s"',t.STORAGE_KEY="storage",t.HOUR_IN_SECOND=3600,t.TIME_OUT=1e3},170:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function s(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,c)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.displayControlItems=t.registerEvents=t.next=t.prev=t.playTrack=t.pauseTrack=t.getDeviceID=void 0;const o=i(623),r=i(561);function s(e,t){return n(this,void 0,void 0,(function*(){const i=`${o.API_URL}/v1/me/player/pause?device_id=${e}`;try{return yield fetch(i,{method:"PUT",headers:{Authorization:`Bearer ${t}`}})}catch(e){throw e}}))}function c(e,t,i){return n(this,void 0,void 0,(function*(){const n=`${o.API_URL}/v1/me/player/play?device_id=${t}`,r={position_ms:e.progressMs};try{return yield fetch(n,{method:"PUT",body:JSON.stringify(r),headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`}})}catch(e){throw e}}))}function a(e,t){return n(this,void 0,void 0,(function*(){const i=`${o.API_URL}/v1/me/player/previous?device_id=${e}`;try{return yield fetch(i,{method:"POST",headers:{Authorization:`Bearer ${t}`}})}catch(e){throw e}}))}function l(e,t){return n(this,void 0,void 0,(function*(){const i=`${o.API_URL}/v1/me/player/next?device_id=${e}`;try{return yield fetch(i,{method:"POST",headers:{Authorization:`Bearer ${t}`}})}catch(e){throw e}}))}function u(e){return n(this,void 0,void 0,(function*(){var t=document.getElementById("play"),i=document.getElementById("pause");switch(e){case"play":t.style.display="none",i.style.display="flex";break;case"pause":t.style.display="flex",i.style.display="none"}}))}t.getDeviceID=function(e){return n(this,void 0,void 0,(function*(){const t=yield r.getRecentPlayback(e);if(null==t.device)return;const{id:i,is_active:n,is_private_session:o,is_restricted:s,name:c,type:a,volume_percent:l}=t.device;return{id:i,is_active:n,is_private_session:o,is_restricted:s,name:c,type:a,volume_percent:l}}))},t.pauseTrack=s,t.playTrack=c,t.prev=a,t.next=l,t.registerEvents=function(e,t,i,r){const d=document.getElementById("prev"),y=document.getElementById("pause"),p=document.getElementById("play"),h=document.getElementById("next");function v(){return n(this,void 0,void 0,(function*(){u("pause"),yield s(t,e.accessToken)}))}function f(){return n(this,void 0,void 0,(function*(){u("play"),yield c(i,t,e.accessToken)}))}document.getElementById("save"),document.getElementById("un-save"),document.getElementById("repeat"),document.addEventListener("keydown",(e=>n(this,void 0,void 0,(function*(){e.preventDefault(),"Space"===e.code&&(!0===i.isPlaying?yield v():yield f())})))),y.onclick=function(e){return n(this,void 0,void 0,(function*(){e.preventDefault(),yield v()}))},p.onclick=function(e){return n(this,void 0,void 0,(function*(){e.preventDefault(),yield f()}))},d.onclick=function(i){return n(this,void 0,void 0,(function*(){i.preventDefault(),yield a(t,e.accessToken),setTimeout((()=>n(this,void 0,void 0,(function*(){yield r()}))),o.TIME_OUT)}))},h.onclick=function(i){return n(this,void 0,void 0,(function*(){i.preventDefault(),yield l(t,e.accessToken),setTimeout((()=>n(this,void 0,void 0,(function*(){yield r()}))),o.TIME_OUT)}))}},t.displayControlItems=u},561:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function s(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,c)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.parse=t.parseDevice=t.isUpdateStorage=t.getRecentlyPlayedTrack=t.getRecentPlayback=t.getAccessToken=t.getMyDevice=void 0;const o=i(623);t.getMyDevice=function(e){return n(this,void 0,void 0,(function*(){const t=`${o.API_URL}/v1/me/player/devices`;try{return yield fetch(t,{headers:{Authorization:`Bearer ${e}`}})}catch(e){}}))},t.getAccessToken=function(){return n(this,void 0,void 0,(function*(){let e={clientId:null,accessToken:null,accessTokenExpirationTime:null,isAnonymous:null};try{const t=`${o.WEB_PLAYER_URL}/get_access_token`,i=yield fetch(t);e=yield i.json()}catch(e){}return e}))},t.getRecentPlayback=function(e){return n(this,void 0,void 0,(function*(){const t=`${o.API_URL}/v1/me/player?additional_types=track`;try{const i=yield fetch(t,{headers:{Authorization:`Bearer ${e}`}});return yield i.json()}catch(e){return!1}}))},t.getRecentlyPlayedTrack=function(e){return n(this,void 0,void 0,(function*(){const t=`${o.API_URL}/v1/me/player/recently-played`;try{const i=yield fetch(t,{headers:{Authorization:`Bearer ${e}`}});let n=yield i.json();if(n&&n.items.length){const{track:e,context:t}=n.items[0];return{item:e,context:t}}return}catch(e){return}}))},t.isUpdateStorage=function(e,t){return!!(!e||t&&t.title!==e.title||t&&t.isPlaying!==e.isPlaying||t&&t.uri!==e.uri||t&&t.uri===e.uri&&t.progressMs!==e.progressMs||t&&t.uri===e.uri&&t.isSave!==e.isSave||t&&t.uri===e.uri&&t.repeatState!==e.repeatState)},t.parseDevice=function(e){return n(this,void 0,void 0,(function*(){if(null==e)return;const t=yield e.json();var i=["Computer"];return(t.devices?t.devices.filter((e=>i.indexOf(e.type)>-1)).map((e=>({id:e.id,isActive:e.is_active,isRestricted:e.is_restricted,name:e.name,type:e.type,volumePercent:e.volume_percent}))):[])[0]}))},t.parse=function(e){if(!e||e&&!e.item)return;const{is_playing:t,progress_ms:i,repeat_state:n,item:{name:o,artists:r,album:{images:s},uri:c,id:a,duration_ms:l,external_urls:{spotify:u}}}=e;let d="",y="";(null==r?void 0:r.length)&&(d=r[0].name,y=r[0].external_urls.spotify);const p=(null==s?void 0:s.length)?s[1].url:"";let h;if(e.context){const{type:t,href:i,external_urls:n,uri:o}=e.context;h={type:t,href:i,uri:o,externalUrls:n}}return{title:o,artist:{name:d,url:y},repeatState:n,isPlaying:t,coverPhoto:p,uri:c,progressMs:i,context:h,durationMs:l,trackUrl:u,id:a}}},975:(e,t,i)=>{(new(i(874).App)).render()}},t={};!function i(n){if(t[n])return t[n].exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,i),o.exports}(975)})();